name: Validate Config

on:
  push:
    paths:
      - 'config.json'
  pull_request:
    paths:
      - 'config.json'

jobs:
  validate:
    name: ğŸ” Walidacja konfiguracji
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'

      - name: âœ… Validate JSON syntax
        run: |
          echo "ğŸ” Sprawdzanie skÅ‚adni config.json..."
          if python3 -c "import json; json.load(open('config.json'))"; then
            echo "âœ… SkÅ‚adnia JSON poprawna"
          else
            echo "âŒ BÅ‚Ä…d skÅ‚adni JSON"
            exit 1
          fi

      - name: ğŸ“‹ Validate required fields
        run: |
          python3 << 'EOF'
          import json
          import sys

          print("ğŸ“‹ Walidacja wymaganych pÃ³l...")
          
          with open('config.json', 'r', encoding='utf-8') as f:
              config = json.load(f)

          required = {
              'site': ['title', 'language'],
              'instructor': ['name', 'department', 'university'],
              'branding': ['logo_text', 'primary_color', 'accent_color'],
              'footer': ['copyright', 'note'],
              'features': ['dark_mode', 'pdf_preview', 'search', 'filters']
          }

          errors = []
          warnings = []
          
          for section, fields in required.items():
              if section not in config:
                  errors.append(f"Brak sekcji: {section}")
              else:
                  for field in fields:
                      if field not in config[section]:
                          errors.append(f"Brak pola: {section}.{field}")
                      elif config[section][field] == "" or config[section][field] is None:
                          warnings.append(f"Puste pole: {section}.{field}")

          # Walidacja kolorÃ³w HEX
          import re
          hex_pattern = re.compile(r'^#[0-9A-Fa-f]{6}$')
          
          if 'branding' in config:
              for color_field in ['primary_color', 'accent_color']:
                  if color_field in config['branding']:
                      color = config['branding'][color_field]
                      if not hex_pattern.match(color):
                          errors.append(f"NieprawidÅ‚owy kolor HEX: branding.{color_field} = '{color}'")

          # Walidacja jÄ™zyka
          if 'site' in config and 'language' in config['site']:
              lang = config['site']['language']
              if lang not in ['pl', 'en', 'de', 'fr', 'es']:
                  warnings.append(f"Nieznany jÄ™zyk: {lang} (obsÅ‚ugiwane: pl, en, de, fr, es)")

          if warnings:
              print("âš ï¸  OstrzeÅ¼enia:")
              for w in warnings:
                  print(f"   â€¢ {w}")

          if errors:
              print("âŒ BÅ‚Ä™dy walidacji:")
              for e in errors:
                  print(f"   â€¢ {e}")
              sys.exit(1)
          else:
              print("âœ… Wszystkie wymagane pola sÄ… poprawne")
              print("")
              print("ğŸ“Š Podsumowanie konfiguracji:")
              print(f"   ğŸ“ WykÅ‚adowca: {config['instructor']['name']}")
              print(f"   ğŸ›ï¸  WydziaÅ‚: {config['instructor']['department']}")
              print(f"   ğŸ¨ Kolor gÅ‚Ã³wny: {config['branding']['primary_color']}")
              print(f"   ğŸŒ JÄ™zyk: {config['site']['language']}")
          EOF

      - name: ğŸ“Š Config Summary
        if: success()
        run: |
          echo ""
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
          echo "âœ… Konfiguracja jest poprawna i gotowa!"
          echo "â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
